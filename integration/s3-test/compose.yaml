services:
  minis3:
    build:
      context: ../..
      dockerfile: integration/s3-test/Dockerfile.minis3
    ports:
      - "9000:9000"
    environment:
      - MINIS3_LC_DEBUG_INTERVAL_SECONDS=1
    healthcheck:
      test: ["CMD", "wget", "-q", "-O", "/dev/null", "http://localhost:9000/"]
      interval: 2s
      timeout: 5s
      retries: 5

  s3tests:
    build:
      context: .
      dockerfile: Dockerfile.s3tests
    depends_on:
      minis3:
        condition: service_healthy
    environment:
      S3TEST_CONF: /s3tests.conf
      PYTEST_ADDOPTS: -m "not fails_on_aws and not fails_on_rgw"
